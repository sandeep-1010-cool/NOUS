# Creating an EKS Cluster with Pulumi

## Key Concepts
Pulumi is **declarative**, meaning you define the desired state of your infrastructure, and Pulumi handles the underlying changes to achieve that state. This eliminates the need to manually track infrastructure changes.

## Steps to Create an EKS Cluster

### Step 1: Cleaning Up Existing Resources
- Delete existing code and execute:
  ```bash
  pulumi up
  ```
- Pulumi will clean up all resources (e.g., deleting buckets if no buckets are desired).
- **Declarative Advantage**: Pulumi tracks the infrastructure state automatically, so you don’t need to specify actions like "delete 3 buckets."

### Step 2: Setting Up Dependencies
- Add the EKS Pulumi library as a dependency in `package.json`.
- Use your editor’s auto-suggestions to select the appropriate version of the library.
- Install the library:
  ```bash
  npm install
  ```

### Step 3: Creating a VPC
- Define a new VPC resource:
  ```javascript
  const vpc = new awsx.ec2.Vpc("my-vpc", {
    cidrBlock: "10.0.0.0/16" // IP address range for the VPC
  });
  ```
- **Auto-Suggestions**: Programming languages provide helpful suggestions for function names and attributes, making it easier to write code.

### Step 4: Creating an EKS Cluster
- Define the EKS cluster using the VPC:
  ```javascript
  const cluster = new awsx.eks.Cluster("my-cluster", {
    vpcId: vpc.id, // Reference the VPC ID
    subnetIds: vpc.subnetIds, // Reference subnet IDs from the VPC
    instanceType: "t2.medium" // Set the instance type
  });
  ```
- **Configuration Options**: Resources allow overriding defaults, such as:
  - CIDR block
  - VPC ID
  - Instance type

### Step 5: Exporting Outputs
- Export the kubeconfig file to connect to the EKS cluster:
  ```javascript
  exports.kubeconfig = cluster.kubeconfig;
  ```

### Step 6: Executing the Program
- Run the program:
  ```bash
  pulumi up
  ```
- Pulumi provides a preview of all resources to be created.
- Confirm the execution to create the EKS cluster (takes ~10 minutes).

## Pulumi Console Features

### Resources Tab
- Displays a **list of resources** in your infrastructure.
- Resources are organized by prefixes to differentiate platforms (e.g., AWS, Kubernetes).
- Includes convenient links to view resources directly in the AWS console.

### Graph View
- Provides a **hierarchical overview** of resources:
  - Shows connections and dependencies between resources.
  - Displays background components created underneath high-level resources (e.g., VPC and EKS cluster).

### Infrastructure History
- Tracks the history of infrastructure changes.
- Shows changes made by team members, including code updates and their impact on infrastructure.

## Cleaning Up Resources
- To delete all resources created by the program, execute:
  ```bash
  pulumi destroy
  ```
- This reverses the `pulumi up` execution, cleaning up all resources.

## Summary
Pulumi simplifies infrastructure management through its declarative approach. Key benefits include:
- Automated state tracking.
- Integration with programming languages for intuitive coding.
- A user-friendly console for tracking infrastructure history and state.
- Tools for visualization (graph view) and cleanup (`pulumi destroy`).

Pulumi provides a powerful and efficient workflow for creating and managing infrastructure, making it ideal for modern DevOps practices.
